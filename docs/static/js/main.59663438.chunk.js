(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{36:function(e,t,a){e.exports=a(63)},41:function(e,t,a){},63:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),l=a(31),c=a.n(l),i=a(11),o=(a(41),a(12)),s=a(16),u=a(6),m=a(7),d=a(9),f=a(8),v=a(10),p=a(13),h=a(32),E=a.n(h),g=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u041e\u0448\u0438\u0431\u043a\u0430"),n.a.createElement(i.b,{to:"/"},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e")))},_=function(e){var t=e.children;return n.a.createElement("main",null,n.a.createElement("div",{className:"container"},t))},b=function(e){var t=e.error;return n.a.createElement(n.a.Fragment,null,n.a.createElement(g,null),n.a.createElement(_,null,n.a.createElement("span",null,t.toString())))},y=function(){return n.a.createElement(_,null,n.a.createElement("div",{className:"loading"},n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null)))},N=a(35);function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function O(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var w=n.a.createElement("path",{d:"M20.389 4.611c-2.147-2.148-5.63-2.148-7.778 0-.226.226-.43.469-.611.725-.18-.256-.384-.499-.611-.725-2.147-2.148-5.63-2.148-7.778 0-2.148 2.148-2.148 5.63 0 7.778l7.682 7.682c.391.39 1.024.39 1.414 0l7.682-7.682c2.148-2.148 2.148-5.63 0-7.778"}),F=function(e){var t=e.svgRef,a=O(e,["svgRef"]);return n.a.createElement("svg",S({width:24,height:24,ref:t},a),w)},j=n.a.forwardRef(function(e,t){return n.a.createElement(F,S({svgRef:t},e))}),k=(a.p,function(e){var t=e.isFavorite,a=e.data,r=e.context,l=r.addFavorite,c=r.removeFavorite;return n.a.createElement("button",{type:"button",className:"item__fav-btn",onClick:t?function(){return c(a)}:function(){return l(a)}},n.a.createElement(j,{fill:t?"red":"white",fillRule:"evenodd",stroke:t?"darkred":"grey",className:"item__fav-icon"}))}),T=n.a.createContext(),x=T.Provider,C=T.Consumer,P=T;var H=function(e){var t=e.data,a=t.title,r=t.price,l=t.pictures,c=t.seller,i=t.isFavorite;return n.a.createElement("li",{className:"item"},n.a.createElement("div",null,n.a.createElement("div",{className:"item__img-container"},n.a.createElement("img",{className:"border item__img",src:"https:"+l[0],alt:a}),l.length>0&&n.a.createElement("div",{className:"item__img-counter"},n.a.createElement("span",null,l.length-1))),n.a.createElement("h5",{className:"item__header"},a)),r?n.a.createElement("div",{className:"item__price my-2"},function(e){return Object(N.a)(e.toString()).reverse().map(function(e,t){return(t+1)%3||0===t?e:" "+e}).reverse().join("")}(r)," \u20bd"):n.a.createElement("div",{className:"item__price-empty my-2"},"\u0426\u0435\u043d\u0430 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430"),n.a.createElement("div",{className:"mb-2"},n.a.createElement("div",null,"\u041f\u0440\u043e\u0434\u0430\u0432\u0435\u0446: "),n.a.createElement("div",null,c.name)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0420\u0435\u0439\u0442\u0438\u043d\u0433: "),n.a.createElement("span",null,c.rating)),n.a.createElement(C,null,function(e){return n.a.createElement(k,{isFavorite:i,data:t,context:e})}))};var A=function(e){var t=e.items,a=e.sellers,r=e.favorites,l=e.itemsToShow;return n.a.createElement(n.a.Fragment,null,t.length>0?n.a.createElement("ul",{className:"content__items-list"},function(e,t){var a=e.items,r=e.sellers,l=e.favorites;return a.map(function(e,a){if(a<t){var c=r.find(function(t){return t.id===e.relationships.seller}),i=!l||l.find(function(t){return t.id===e.id});return n.a.createElement(H,{key:e.id,data:Object(s.a)({},e,{seller:c,isFavorite:i})})}return!1})}({items:t,sellers:a,favorites:r},l)):n.a.createElement("div",{className:"content__items-empty"},"\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"))},D=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={category:a.context.filters.category},a.changeHandler=function(e){a.setState({category:e.target.value},function(){return a.context.setFilter({name:"category",value:a.state.category})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.category;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"all",checked:"all"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0412\u0441\u0435")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"immovable",checked:"immovable"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041d\u0435\u0434\u0432\u0438\u0436\u0438\u043c\u043e\u0441\u0442\u044c")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"cameras",checked:"cameras"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0424\u043e\u0442\u043e\u0430\u043f\u043f\u0430\u0440\u0430\u0442\u044b")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"auto",checked:"auto"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0410\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u0438")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"laptops",checked:"laptops"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041d\u043e\u0443\u0442\u0431\u0443\u043a\u0438")))}}]),t}(r.Component);D.contextType=P;var I=D,R=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={from:a.context.filters.price.from,to:a.context.filters.price.to},a.changeHandler=function(e){var t=e.target,r=t.value,n=t.id;r||(r="all"),a.setState(Object(o.a)({},n,r),function(){return a.context.setFilter({name:"price",value:a.state})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state,t=e.from,a=e.to;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-number",value:"all"===t?"":t,type:"number",id:"from",name:"price",onChange:this.changeHandler,placeholder:"\u0426\u0435\u043d\u0430 \u043e\u0442"})),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-number",value:"all"===a?"":a,type:"number",id:"to",name:"price",onChange:this.changeHandler,placeholder:"\u0434\u043e, \u0440\u0443\u0431."})))}}]),t}(r.Component);R.contextType=P;var J=R,B=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={isFavorite:a.context.filters.isFavorite},a.changeHandler=function(e){a.setState({isFavorite:Boolean(Number(e.target.value))},function(){return a.context.setFilter({name:"isFavorite",value:a.state.isFavorite})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.isFavorite;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"favorites",value:0,checked:!e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0412\u0441\u0435 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"favorites",value:1,checked:e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0422\u043e\u043b\u044c\u043a\u043e \u0438\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435")))}}]),t}(r.Component);B.contextType=P;var M=B,L=function(){return n.a.createElement("form",{className:"form my-2"},n.a.createElement("h5",null,"\u0424\u0438\u043b\u044c\u0442\u0440\u044b"),n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("span",null,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),n.a.createElement(I,null)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0426\u0435\u043d\u0430"),n.a.createElement(J,null)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(M,null))))},U=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={value:a.context.sorting.value,direction:a.context.sorting.direction},a.changeHandler=function(e){var t=e.target,r=t.name,n=t.value;a.setState(Object(o.a)({},r,n),function(){return a.context.setSorting(a.state)})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state,t=e.value,a=e.direction;return n.a.createElement("form",{className:"form"},n.a.createElement("div",{className:"form__wrapper-sort"},n.a.createElement("div",null,n.a.createElement("h5",null,"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430"),n.a.createElement("div",{className:"mr-5"},n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"value",value:"default",checked:"default"===t,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041d\u043e\u043c\u0435\u0440 \u0442\u043e\u0432\u0430\u0440\u0430")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"value",value:"rating",checked:"rating"===t,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0420\u0435\u0439\u0442\u0438\u043d\u0433 \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u0430")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"value",value:"price",checked:"price"===t,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0426\u0435\u043d\u0430")))),n.a.createElement("div",null,n.a.createElement("h5",null,"\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438"),n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"direction",value:"asc",checked:"asc"===a,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},n.a.createElement("span",{className:"hidden__mobile"},"\u0412\u043e\u0437\u0440\u0430\u0441\u0442\u0430\u043d\u0438\u0435"),n.a.createElement("span",{className:"hidden__desktop hidden-tablet"},"\u25b2"))),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"direction",value:"desc",checked:"desc"===a,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},n.a.createElement("span",{className:"hidden__mobile"},"\u0423\u0431\u044b\u0432\u0430\u043d\u0438\u0435"),n.a.createElement("span",{className:"hidden__desktop hidden-tablet"},"\u25bc")))))))}}]),t}(r.Component);U.contextType=P;var q=U,z=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"),n.a.createElement(i.b,{to:"/favorites"},"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(L,null),n.a.createElement(q,null)))},G=9,K=3,Q=100,V=function(e){var t=e.filterContext,a=e.favoritesContext,l=e.items,c=e.itemsToShow,i=e.sellers,o=e.favorites,s=e.setProductsToShow,u=t.setFilter,m=t.setSorting,d=t.sorting,f=t.filters,v=a.addFavorite,p=a.removeFavorite;return Object(r.useEffect)(function(){return function(){return s(G)}},[s]),n.a.createElement(n.a.Fragment,null,n.a.createElement(x,{value:{setFilter:u,setSorting:m,sorting:d,filters:f}},n.a.createElement(z,null)),n.a.createElement(x,{value:{addFavorite:v,removeFavorite:p}},n.a.createElement(_,null,n.a.createElement(A,{items:l,itemsToShow:c,sellers:i,favorites:o}))))},W=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(i.b,{to:"/"},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e")))},X=function(e){var t=e.favoritesContext,a=e.items,l=e.itemsToShow,c=e.sellers,i=e.setProductsToShow,o=t.addFavorite,s=t.removeFavorite;return Object(r.useEffect)(function(){return function(){return i(G)}},[i]),n.a.createElement(n.a.Fragment,null,n.a.createElement(W,null),n.a.createElement(x,{value:{addFavorite:o,removeFavorite:s}},n.a.createElement(_,null,n.a.createElement(A,{items:a,itemsToShow:l,sellers:c}))))},Y=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={loading:!0,error:!1,products:[],filteredProducts:null,sellers:[],favorites:JSON.parse(localStorage.getItem("avito-favorites"))||[],filters:{category:"all",price:{from:"all",to:"all"},isFavorite:!1},sorting:{value:"default",direction:"asc"},productsToShow:G},a.addFavorite=function(e){var t=a.state.favorites.slice(0);t.push(e),a.setState({favorites:t})},a.removeFavorite=function(e){var t=a.state.favorites.slice(0),r=t.findIndex(function(t){return t.id===e.id});t.splice(r,1),a.setState({favorites:t})},a.scrollHandler=function(e){var t=e.target.documentElement;t.clientHeight+t.scrollTop>=t.scrollHeight-Q&&a.state.productsToShow<a.state.products.length&&a.setProductsToShow(a.state.productsToShow+K)},a.setProductsToShow=function(e){return a.setState({productsToShow:e})},a.setSorting=function(e){return a.setState({sorting:e})},a.setFilter=function(e){return a.setState({filters:Object(s.a)({},a.state.filters,Object(o.a)({},e.name,e.value))})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"fetchData",value:function(e){return E.a.get(e).then(function(e){if(200!==e.status)throw new Error("Network error");return e.data})}},{key:"filterProducts",value:function(){var e=this,t=this.state,a=t.filters,r=t.products,n=t.favorites,l=a.category,c=a.price,i=c.from,o=c.to,s=a.isFavorite,u=r.slice(0);u=u.filter(function(e){var t=e.price||0;return!("all"!==l&&e.category!==l||!("all"===i||t>=i)||!("all"===o||t<o)||s&&!n.find(function(t){return t.id===e.id}))&&e}),this.setState({filteredProducts:u},function(){return e.setProductsToShow(G)})}},{key:"sortProducts",value:function(){var e=this,t=this.state,a=t.sorting,r=a.value,n=a.direction,l=t.products,c=t.sellers,i=l.slice(0);i.sort(function(e,t){switch(r){case"price":var a=e.price||0,l=t.price||0;return"asc"===n?a-l:l-a;case"rating":var i=c.find(function(t){return t.id===e.relationships.seller}),o=c.find(function(e){return e.id===t.relationships.seller});return"asc"===n?i.rating-o.rating:o.rating-i.rating;case"default":default:return"asc"===n?e.id-t.id:t.id-e.id}}),this.setState({products:i},function(){return e.setProductsToShow(G)})}},{key:"setTitle",value:function(e){document.title=e}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.scrollHandler);var t=this.fetchData("https://avito.dump.academy/products"),a=this.fetchData("https://avito.dump.academy/sellers");Promise.all([t,a]).then(function(t){return e.setState({loading:!1,products:t[0].data,sellers:t[1].data})}).catch(function(t){return e.setState({loading:!1,error:t})})}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,r=a.products,n=a.filteredProducts,l=a.filters,c=a.sorting,i=a.favorites;(t.filters!==l||t.products!==r&&t.products.length)&&this.filterProducts(),t.sorting!==c&&this.sortProducts(),t.favorites!==i&&(localStorage.setItem("avito-favorites",JSON.stringify(i)),n&&this.filterProducts())}},{key:"render",value:function(){var e=this,t=this.state,a=t.products,r=t.sellers,l=t.loading,c=t.error,i=t.filteredProducts,o=t.favorites,u=t.productsToShow,m=t.sorting,d=t.filters,f=Object(s.a)({},this),v=f.setFilter,h=f.setSorting,E=f.addFavorite,g=f.removeFavorite,_=f.setProductsToShow;return n.a.createElement(n.a.Fragment,null,l&&!c&&n.a.createElement(y,null),c&&n.a.createElement(b,{error:c}),!l&&!c&&n.a.createElement(p.c,null,n.a.createElement(p.a,{exact:!0,path:"/",render:function(){return e.setTitle("Avito test"),n.a.createElement(V,{filterContext:{setFilter:v,setSorting:h,sorting:m,filters:d},favoritesContext:{addFavorite:E,removeFavorite:g},items:i||a,itemsToShow:u,sellers:r,favorites:o,setProductsToShow:_})}}),n.a.createElement(p.a,{path:"/favorites",render:function(){return e.setTitle("Favorites"),n.a.createElement(X,{favoritesContext:{addFavorite:E,removeFavorite:g},items:o,itemsToShow:u,sellers:r,setProductsToShow:_})}}),n.a.createElement(p.a,{render:function(){return e.setTitle("404"),n.a.createElement(b,{error:"page not found"})}})))}}]),t}(r.Component);c.a.render(n.a.createElement(i.a,{basename:"/Avito-test"},n.a.createElement(Y,null)),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.59663438.chunk.js.map