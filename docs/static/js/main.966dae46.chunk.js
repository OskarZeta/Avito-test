(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{36:function(e,t,a){e.exports=a(63)},41:function(e,t,a){},63:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),l=a(31),o=a.n(l),c=a(11),i=(a(41),a(13)),s=a(16),u=a(6),m=a(7),d=a(9),f=a(8),v=a(10),p=a(12),h=a(32),E=a.n(h),g=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u041e\u0448\u0438\u0431\u043a\u0430"),n.a.createElement(c.b,{to:"/"},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e")))},y=function(e){var t=e.children;return n.a.createElement("main",null,n.a.createElement("div",{className:"container"},t))},b=function(e){var t=e.error;return n.a.createElement(n.a.Fragment,null,n.a.createElement(g,null),n.a.createElement(y,null,n.a.createElement("span",null,t.toString())))},_=function(){return n.a.createElement(y,null,n.a.createElement("div",{className:"loading"},n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null)))},S=a(35);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function F(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var N=n.a.createElement("path",{d:"M20.389 4.611c-2.147-2.148-5.63-2.148-7.778 0-.226.226-.43.469-.611.725-.18-.256-.384-.499-.611-.725-2.147-2.148-5.63-2.148-7.778 0-2.148 2.148-2.148 5.63 0 7.778l7.682 7.682c.391.39 1.024.39 1.414 0l7.682-7.682c2.148-2.148 2.148-5.63 0-7.778"}),w=function(e){var t=e.svgRef,a=F(e,["svgRef"]);return n.a.createElement("svg",O({width:24,height:24,ref:t},a),N)},j=n.a.forwardRef(function(e,t){return n.a.createElement(w,O({svgRef:t},e))}),T=(a.p,function(e){var t=e.isFavorite,a=e.data,r=e.context,l=r.addFavorite,o=r.removeFavorite;return n.a.createElement("button",{type:"button",className:"item__fav-btn",onClick:t?function(){return o(a)}:function(){return l(a)}},n.a.createElement(j,{fill:t?"red":"white",fillRule:"evenodd",stroke:t?"darkred":"grey",className:"item__fav-icon"}))}),k=n.a.createContext(),x=k.Provider,C=k.Consumer,P=k;var H=function(e){var t=e.data,a=t.title,r=t.price,l=t.pictures,o=t.seller,c=t.isFavorite;return n.a.createElement("li",{className:"item"},n.a.createElement("div",null,n.a.createElement("img",{className:"border item__img",src:"https:"+l[0],alt:a}),n.a.createElement("h5",{className:"item__header"},a)),r?n.a.createElement("div",{className:"item__price my-2"},function(e){return Object(S.a)(e.toString()).reverse().map(function(e,t){return(t+1)%3||0===t?e:" "+e}).reverse().join("")}(r)," \u20bd"):n.a.createElement("div",{className:"item__price-empty my-2"},"\u0426\u0435\u043d\u0430 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430"),n.a.createElement("div",{className:"mb-2"},n.a.createElement("div",null,"\u041f\u0440\u043e\u0434\u0430\u0432\u0435\u0446: "),n.a.createElement("div",null,o.name)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0420\u0435\u0439\u0442\u0438\u043d\u0433: "),n.a.createElement("span",null,o.rating)),n.a.createElement(C,null,function(e){return n.a.createElement(T,{isFavorite:c,data:t,context:e})}))};var A=function(e){var t=e.items,a=e.sellers,r=e.favorites,l=e.itemsToShow;return n.a.createElement(n.a.Fragment,null,t.length>0?n.a.createElement("ul",{className:"content__items-list"},function(e,t){var a=e.items,r=e.sellers,l=e.favorites;return a.map(function(e,a){if(a<t){var o=r.find(function(t){return t.id===e.relationships.seller}),c=!l||l.find(function(t){return t.id===e.id});return n.a.createElement(H,{key:e.id,data:Object(s.a)({},e,{seller:o,isFavorite:c})})}return!1})}({items:t,sellers:a,favorites:r},l)):n.a.createElement("div",{className:"content__items-empty"},"\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"))},D=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={category:a.context.filters.category},a.changeHandler=function(e){a.setState({category:e.target.value},function(){return a.context.setFilter({name:"category",value:a.state.category})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.category;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"all",checked:"all"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0412\u0441\u0435")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"immovable",checked:"immovable"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041d\u0435\u0434\u0432\u0438\u0436\u0438\u043c\u043e\u0441\u0442\u044c")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"cameras",checked:"cameras"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0424\u043e\u0442\u043e\u0430\u043f\u043f\u0430\u0440\u0430\u0442\u044b")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"auto",checked:"auto"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0410\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u0438")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"category",value:"laptops",checked:"laptops"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041d\u043e\u0443\u0442\u0431\u0443\u043a\u0438")))}}]),t}(r.Component);D.contextType=P;var I=D,R=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={from:a.context.filters.price.from,to:a.context.filters.price.to},a.changeHandler=function(e){var t=e.target,r=t.value,n=t.id;r||(r="all"),a.setState(Object(i.a)({},n,r),function(){return a.context.setFilter({name:"price",value:a.state})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state,t=e.from,a=e.to;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-number",value:"all"===t?"":t,type:"number",id:"from",name:"price",onChange:this.changeHandler,placeholder:"\u0426\u0435\u043d\u0430 \u043e\u0442"})),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-number",value:"all"===a?"":a,type:"number",id:"to",name:"price",onChange:this.changeHandler,placeholder:"\u0434\u043e, \u0440\u0443\u0431."})))}}]),t}(r.Component);R.contextType=P;var J=R,B=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={isFavorite:a.context.filters.isFavorite},a.changeHandler=function(e){a.setState({isFavorite:Boolean(Number(e.target.value))},function(){return a.context.setFilter({name:"isFavorite",value:a.state.isFavorite})})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.isFavorite;return n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"favorites",value:0,checked:!e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0412\u0441\u0435 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"favorites",value:1,checked:e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0422\u043e\u043b\u044c\u043a\u043e \u0438\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435")))}}]),t}(r.Component);B.contextType=P;var M=B,L=function(){return n.a.createElement("form",{className:"form my-2"},n.a.createElement("h5",null,"\u0424\u0438\u043b\u044c\u0442\u0440\u044b"),n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("span",null,"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"),n.a.createElement(I,null)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0426\u0435\u043d\u0430"),n.a.createElement(J,null)),n.a.createElement("div",null,n.a.createElement("span",null,"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(M,null))))},U=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={sort_by:a.context.sorting},a.changeHandler=function(e){a.setState({sort_by:e.target.value},function(){return a.context.setSorting(a.state.sort_by)})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.sort_by;return n.a.createElement("form",{className:"form"},n.a.createElement("h5",null,"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 (\u043f\u043e \u0432\u043e\u0437\u0440\u0430\u0441\u0442\u0430\u043d\u0438\u044e)"),n.a.createElement("div",null,n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"sorting",value:"popularity",checked:"popularity"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u041f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u043e\u0441\u0442\u044c")),n.a.createElement("label",null,n.a.createElement("input",{className:"form__input-radio",type:"radio",name:"sorting",value:"price",checked:"price"===e,onChange:this.changeHandler}),n.a.createElement("span",{className:"form__custom-input-radio"},"\u0426\u0435\u043d\u0430"))))}}]),t}(r.Component);U.contextType=P;var q=U,z=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"),n.a.createElement(c.b,{to:"/favorites"},"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(L,null),n.a.createElement(q,null)))},G=9,K=3,Q=100,V=function(e){var t=e.filterContext,a=e.favoritesContext,l=e.items,o=e.itemsToShow,c=e.sellers,i=e.favorites,s=e.setProductsToShow,u=t.setFilter,m=t.setSorting,d=t.sorting,f=t.filters,v=a.addFavorite,p=a.removeFavorite;return Object(r.useEffect)(function(){return function(){return s(G)}},[s]),n.a.createElement(n.a.Fragment,null,n.a.createElement(x,{value:{setFilter:u,setSorting:m,sorting:d,filters:f}},n.a.createElement(z,null)),n.a.createElement(x,{value:{addFavorite:v,removeFavorite:p}},n.a.createElement(y,null,n.a.createElement(A,{items:l,itemsToShow:o,sellers:c,favorites:i}))))},W=function(){return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"container"},n.a.createElement("h1",null,"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435"),n.a.createElement(c.b,{to:"/"},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e")))},X=function(e){var t=e.favoritesContext,a=e.items,l=e.itemsToShow,o=e.sellers,c=e.setProductsToShow,i=t.addFavorite,s=t.removeFavorite;return Object(r.useEffect)(function(){return function(){return c(G)}},[c]),n.a.createElement(n.a.Fragment,null,n.a.createElement(W,null),n.a.createElement(x,{value:{addFavorite:i,removeFavorite:s}},n.a.createElement(y,null,n.a.createElement(A,{items:a,itemsToShow:l,sellers:o}))))},Y=function(e){function t(){var e,a;Object(u.a)(this,t);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(n)))).state={loading:!0,error:!1,products:[],filteredProducts:null,sellers:[],favorites:JSON.parse(localStorage.getItem("avito-favorites"))||[],filters:{category:"all",price:{from:"all",to:"all"},isFavorite:!1},sorting:"popularity",productsToShow:G},a.addFavorite=function(e){var t=a.state.favorites.slice(0);t.push(e),a.setState({favorites:t})},a.removeFavorite=function(e){var t=a.state.favorites.slice(0),r=t.findIndex(function(t){return t.id===e.id});t.splice(r,1),a.setState({favorites:t})},a.scrollHandler=function(e){var t=e.target.documentElement;t.clientHeight+t.scrollTop>=t.scrollHeight-Q&&a.state.productsToShow<a.state.products.length&&a.setProductsToShow(a.state.productsToShow+K)},a.setProductsToShow=function(e){return a.setState({productsToShow:e})},a.setSorting=function(e){return a.setState({sorting:e})},a.setFilter=function(e){return a.setState({filters:Object(s.a)({},a.state.filters,Object(i.a)({},e.name,e.value))})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"fetchData",value:function(e){return E.a.get(e).then(function(e){if(200!==e.status)throw new Error("Network error");return e.data})}},{key:"filterProducts",value:function(){var e=this,t=this.state,a=t.filters,r=t.products,n=t.favorites,l=a.category,o=a.price,c=o.from,i=o.to,s=a.isFavorite,u=r.slice(0);u=u.filter(function(e){var t=e.price||0;return!("all"!==l&&e.category!==l||!("all"===c||t>=c)||!("all"===i||t<i)||s&&!n.find(function(t){return t.id===e.id}))&&e}),this.setState({filteredProducts:u},function(){return e.setProductsToShow(G)})}},{key:"sortProducts",value:function(){var e=this,t=this.state,a=t.sorting,r=t.products.slice(0);r.sort(function(e,t){var r=e.price||0,n=t.price||0;return"price"===a?r-n:e.id-t.id}),this.setState({products:r},function(){return e.setProductsToShow(G)})}},{key:"setTitle",value:function(e){document.title=e}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.scrollHandler);var t=this.fetchData("https://avito.dump.academy/products"),a=this.fetchData("https://avito.dump.academy/sellers");Promise.all([t,a]).then(function(t){return e.setState({loading:!1,products:t[0].data,sellers:t[1].data})}).catch(function(t){return e.setState({loading:!1,error:t})})}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,r=a.products,n=a.filteredProducts,l=a.filters,o=a.sorting,c=a.favorites;(t.filters!==l||t.products!==r&&t.products.length)&&this.filterProducts(),t.sorting!==o&&this.sortProducts(),t.favorites!==c&&(localStorage.setItem("avito-favorites",JSON.stringify(c)),n&&this.filterProducts())}},{key:"render",value:function(){var e=this,t=this.state,a=t.products,r=t.sellers,l=t.loading,o=t.error,c=t.filteredProducts,i=t.favorites,u=t.productsToShow,m=t.sorting,d=t.filters,f=Object(s.a)({},this),v=f.setFilter,h=f.setSorting,E=f.addFavorite,g=f.removeFavorite,y=f.setProductsToShow;return n.a.createElement(n.a.Fragment,null,l&&!o&&n.a.createElement(_,null),o&&n.a.createElement(b,{error:o}),!l&&!o&&n.a.createElement(p.c,null,n.a.createElement(p.a,{exact:!0,path:"/",render:function(){return e.setTitle("Avito test"),n.a.createElement(V,{filterContext:{setFilter:v,setSorting:h,sorting:m,filters:d},favoritesContext:{addFavorite:E,removeFavorite:g},items:c||a,itemsToShow:u,sellers:r,favorites:i,setProductsToShow:y})}}),n.a.createElement(p.a,{path:"/favorites",render:function(){return e.setTitle("Favorites"),n.a.createElement(X,{favoritesContext:{addFavorite:E,removeFavorite:g},items:i,itemsToShow:u,sellers:r,setProductsToShow:y})}}),n.a.createElement(p.a,{render:function(){return e.setTitle("404"),n.a.createElement(b,{error:"page not found"})}})))}}]),t}(r.Component);o.a.render(n.a.createElement(c.a,{basename:"/Avito"},n.a.createElement(Y,null)),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.966dae46.chunk.js.map